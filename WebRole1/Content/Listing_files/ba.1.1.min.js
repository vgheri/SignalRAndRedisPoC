(function(){(function(){var accountId,api,buildKVL,buildUri,bxs,bxv,cookieCache,cookieDomain,cookiePath,decode,e,encode,every,features,filter,forEach,getCookie,getParam,hasCookie,hash,helpers,i,isSpace,item,k,loadingTask,log,makeuid,map,millis,parseCookie,parseKVL,parseUri,parseUrl,pkeys,plkeys,queue,reduce,removeCookie,seconds,sendNextEvent,setCookie,skeys,some,support,topw,trand,trim,v,writeMarkers,_bxs,_bxv,_i,_j,_len,_len1,_ref,_ref1,_ref2,_ref3,_ref4;if((typeof console!=="undefined"&&console!==null?console.log:void 0)!=null){log=console.log}api={version:"1.0",options:{maxage:1000*60*60*24*365,timeout:1000},ready:function(){return function(callback){return callback()}},push:function(cmd){var callback,e,fn,promise;if(!((cmd!=null?cmd.length:void 0)>0)){return}fn=api[cmd.shift()];if(cmd.length>0&&typeof cmd[cmd.length-1]==="function"){callback=cmd.pop()}try{promise=fn.apply(api,cmd)}catch(_error){e=_error;log("error in api call",e)}if((callback!=null)&&typeof promise==="function"){return promise(callback)}}};api.helpers=helpers={};topw=window;try{while((topw.parent!=null)&&topw.parent!==topw){topw.parent.location.toString();topw=topw.parent}}catch(_error){e=_error;if(log!=null){log("find main window",e)}}millis=function(){return new Date().getTime()};seconds=function(){return Math.floor(millis()/1000)};forEach=map=function(a,f){var i,item,_i,_len,_results;_results=[];for(i=_i=0,_len=a.length;_i<_len;i=++_i){item=a[i];_results.push(f(item,i,a))}return _results};every=function(a,f){var i,item,_i,_len;for(i=_i=0,_len=a.length;_i<_len;i=++_i){item=a[i];if(!f(item,i,a)){return false}}return true};some=function(a,f){var i,item,_i,_len;for(i=_i=0,_len=a.length;_i<_len;i=++_i){item=a[i];if(f(item,i,a)){return true}}return false};filter=function(a,f){var i,item,_i,_len,_results;_results=[];for(i=_i=0,_len=a.length;_i<_len;i=++_i){item=a[i];if(!f(item,i,a)){continue}_results.push(item)}return _results};reduce=function(a,f,init){var i,item,value,_i,_len;value=init;for(i=_i=0,_len=a.length;_i<_len;i=++_i){item=a[i];value=f(value,item,i,a)}return value};isSpace=function(c){switch(c){case" ":case"\t":case"\n":case"\r":return true;default:return false}};helpers.trim=trim=function(str){var i,j;i=0;j=str.length-1;while(i<=j&&isSpace(str[i])){i++}if(i===str.length){return""}while(j>=i&&isSpace(str[j])){j--}return str.slice(i,+j+1||9000000000)};hash=function(str){var h,i;if(str==null){str=""}str=str.toString();i=0;h=997;while(i<str.length){h=Math.abs((h*283^str.charCodeAt(i))&4294967295);i+=1}return h};makeuid=function(items){var item;return((function(){var _i,_len,_results;_results=[];for(_i=0,_len=items.length;_i<_len;_i++){item=items[_i];_results.push(parseInt(item).toString(16))}return _results})()).join(".")};helpers.parseKVL=parseKVL=function(s1,s2,str){var i,item,kvl,_i,_len,_ref;if(str==null){str=""}kvl={};_ref=str.split(s1);for(_i=0,_len=_ref.length;_i<_len;_i++){item=_ref[_i];i=item.indexOf(s2);if(!(i>0)){continue}kvl[trim(item.slice(0,i))]=trim(item.slice(i+1))}return kvl};helpers.buildKVL=buildKVL=function(s1,s2,kvl){var k,v;if(kvl==null){kvl={}}return((function(){var _results;_results=[];for(k in kvl){v=kvl[k];if(v!=null){_results.push(k+s2+v)}else{_results.push(k)}}return _results})()).join(s1)};encode=encodeURIComponent;decode=decodeURIComponent;trand=function(){var dt,t,x;x=111;dt=0;t=millis();while(dt===0){dt=millis()-t;x=Math.abs((dt+97)*x&4294967295)}return x};helpers.parseUri=parseUri=function(uri){var i,k,parameters,path,v,_ref;if(uri==null){uri=""}path=uri.toString();parameters={};hash="";i=path.indexOf("#");if(i>=0){hash=path.slice(i+1);path=path.slice(0,i)}i=path.indexOf("?");if(i>=0){_ref=parseKVL("&","=",path.slice(i+1));for(k in _ref){v=_ref[k];parameters[decode(k)]=decode(v.replace("+"," ","g"))}path=path.slice(0,i)}return{path:path,parameters:parameters,hash:hash}};helpers.parseUrl=parseUrl=function(url){var m;if(url==null){url=""}m=url.match(/^([a-zA-Z]+):\/\/([^\/]+)(\/.*)?$/i);url=parseUri(m!=null?m[3]:void 0);if((m!=null?m[1]:void 0)!=null){url.protocol=m[1].toLowerCase()}if((m!=null?m[2]:void 0)!=null){url.host=m[2].toLowerCase()}return url};helpers.buildUri=buildUri=function(uri,parametersOverride,hashOverride){var k,parameters,path,v,_parameters,_ref;_ref=parseUri(uri),path=_ref.path,parameters=_ref.parameters,hash=_ref.hash;if(parametersOverride!=null){for(k in parametersOverride){v=parametersOverride[k];parameters[k]=v}}if(hashOverride!=null){hash=hashOverride}_parameters={};for(k in parameters){v=parameters[k];if(v!=null){_parameters[encode(k)]=encode(v)}}parameters=buildKVL("&","=",_parameters);if(parameters.length>0){parameters="?"+parameters}if(hash.length>0){hash="#"+hash}return path+parameters+hash};cookieCache=null;cookieDomain=null;if(Object.prototype.toString.call(window._bxq)==="[object Array]"){i=0;while(i<window._bxq.length){if(typeof window._bxq[i][0]!=="undefined"&&window._bxq[i][0]==="setCookieDomain"){cookieDomain=window._bxq[i][1];break}i++}}cookiePath="/";parseCookie=function(){var k,v,_ref;if(cookieCache==null){cookieCache={};_ref=parseKVL(";","=",document.cookie);for(k in _ref){v=_ref[k];cookieCache[k]=decode(v)}}return cookieCache};helpers.hasCookie=hasCookie=function(name){return parseCookie()[name]!=null};helpers.getCookie=getCookie=function(name,defaultValue){var value;value=parseCookie()[name];if(value!=null){return value}return defaultValue};helpers.setCookie=setCookie=function(name,value,time,secure){var kv;if(cookieCache==null){parseCookie()}kv={};kv[name]=value.replace(";","","g");if(time!=null){kv.expires=time.toGMTString()}if(cookiePath!=null){kv.path=escape(cookiePath)}if(cookieDomain!=null){kv.domain=escape(cookieDomain)}if(secure){kv.secure=null}window.document.cookie=buildKVL("; ","=",kv);return cookieCache[name]=value};helpers.removeCookie=removeCookie=function(name,secure){setCookie(name," ",new Date(0),secure);return delete cookieCache[name]};helpers.getParam=getParam=function(name,defaultValue){var value;value=parseUri(window.location.href)["parameters"][name];if(value!=null){return value}return defaultValue};api.support=support={cookie:(navigator.cookieEnabled!=null)&&navigator.cookieEnabled,storage:(topw.localStorage!=null)&&(topw.sessionStorage!=null)};if(!support.cookie){try{setCookie("bxanalytics-test","1");if(getCookie("bxanalytics-test")===1){removeCookie("bxanalytics-test");support.cookie=true}}catch(_error){e=_error;if(log!=null){log("check cookie support",e)}}}bxv={};bxs={};if(support.cookie){bxv.r=getCookie("cemv","");bxs.r=getCookie("cems","")}if(support.storage&&(!bxv.r||bxv.r.length===0)&&(!bxs.r||bxv.r.length===0)){bxv.r=window.localStorage.getItem("cemv");bxs.r=window.sessionStorage.getItem("cems")}bxv.v=2;try{if(!bxv.r||bxv.r.length===0){bxv.r=makeuid([hash(topw.navigator.userAgent),trand(),Math.random()*1000,millis()]);bxv.t=seconds()}if(bxv.i!=null){bxv.i=parseInt(bxv.i)+1}else{bxv.i=1}}catch(_error){e=_error;if(log!=null){log("build visitor marker",e)}}bxs.v=2;try{if(!bxs.r||bxs.r.length===0){bxs.r=makeuid([hash(topw.navigator.userAgent),trand(),Math.random()*1000,millis()]);bxs.t=seconds()}if(bxs.i!=null){bxs.i=parseInt(bxs.i)+1}else{bxs.i=1}}catch(_error){e=_error;if(log!=null){log("build session marker",e)}}features={screen:{width:topw.screen.width,height:topw.screen.height,depth:topw.screen.colorDepth},window:{width:topw.outerWidth,height:topw.outerHeight},frame:{width:window.innerWidth,height:window.innerHeight},language:topw.navigator.language};try{features.location=parseUrl(window.location.toString())}catch(_error){e=_error;if(log!=null){log("find location",e)}}features.source={name:"direct",parameters:{}};skeys={q:["alltheweb.com","altavista.com","aol.com","ask.com","bing.com","google","kvasir.no","msn.com","mynet.com","ozu.es","search.com"],query:["aol.com","lycos.com","mamma.com","netscape.com","terra.com"],encquery:["aol.com"],search_word:["eniro.se"],terms:["about.com"],p:["yahoo"],qs:["alice.com","virgilio.it"],rdata:["voila.fr"],wd:["baidu.com"],words:["rambler.ru"]};pkeys={adurl:["google"]};plkeys=["gclid"];try{features.referrer=parseUrl(topw.document.referrer.toString());if(((_ref=features.referrer.host)!=null?_ref.indexOf(topw.document.domain):void 0)<0){if(((_ref1=features.referrer.host)!=null?_ref1.length:void 0)>0){bxs.rh=features.referrer.host}if(((_ref2=features.referrer.path)!=null?_ref2.length:void 0)>0){bxs.rp=features.referrer.path}for(k in skeys){v=skeys[k];if(features.referrer.parameters[k]==null){continue}if(some(v,function(x){return features.referrer.host.indexOf(x)>=0})){features.source.name="organic";features.source.parameters[k]=features.referrer.parameters[k];bxs.rq=features.referrer.parameters[k];break}}for(k in pkeys){v=pkeys[k];if(features.referrer.parameters[k]==null){continue}if(some(v,function(x){return features.referrer.host.indexOf(x)>=0})){features.source.name="paid";features.source.parameters[k]=features.referrer.parameters[k];bxs.rad=1}break}for(_i=0,_len=plkeys.length;_i<_len;_i++){k=plkeys[_i];if(((_ref3=features.location)!=null?_ref3.parameters[k]:void 0)==null){continue}features.source.name="paid";features.source.parameters[k]=features.location.parameters[k];bxs.rad=1;break}}}catch(_error){e=_error;if(log!=null){log("find referrer",e)}}_bxv="";_bxs="";writeMarkers=function(){_bxv={};_bxs={};for(k in bxv){v=bxv[k];_bxv[encode(k)]=encode(v)}for(k in bxs){v=bxs[k];_bxs[encode(k)]=encode(v)}_bxv=_bxv.r;_bxs=_bxs.r;try{if(support.cookie){setCookie("cemv",_bxv,new Date(millis()+api.options.maxage));setCookie("cems",_bxs)}if(support.storage){window.localStorage.setItem("cemv",_bxv);return window.sessionStorage.setItem("cems",_bxs)}}catch(_error){e=_error;if(log!=null){return log("write markers",e)}}};writeMarkers();accountId=null;api.setAccount=function(account){return accountId=account};api.setCookieDomain=function(domain,path){if(path==null){path="/"}if(document.domain.indexOf(domain)>=0){cookieDomain=domain}return cookiePath=path};api.setOptions=function(kv){var _results;if(kv==null){kv={}}_results=[];for(k in kv){v=kv[k];_results.push(api.options[k]=v)}return _results};api.getVisitor=function(){return bxv.r};api.getSession=function(){return bxs.r};api.getVisitorKey=function(){return _bxv};api.getSessionKey=function(){return _bxs};api.getUser=function(){return bxv.u};api.setUser=function(user){if(user!=null){bxv.u=user}else{delete bxv.u}return writeMarkers()};queue=[];loadingTask=null;sendNextEvent=function(){var img,notifier,onError,onLoad,task;loadingTask=null;if(!(queue.length>0)){return}try{loadingTask=task=queue.shift();img=document.createElement("img");onLoad=null;onError=null;notifier=function(success){return function(){var callback,_j,_len1,_ref4;if(task.timeout!=null){clearTimeout(task.timeout)}task.complete=true;task.success=success;try{if(img.removeEventListener){img.removeEventListener("load",onLoad,false);img.removeEventListener("error",onError,false)}else{if(img.detachEvent){img.detachEvent("onload",onLoad);img.detachEvent("onerror",onError)}}_ref4=task.callbacks;for(_j=0,_len1=_ref4.length;_j<_len1;_j++){callback=_ref4[_j];callback(success)}}catch(_error){e=_error;if(log!=null){log("send event",e)}}task.callbacks=[];return sendNextEvent()}};onLoad=notifier(true);onError=notifier(false);if(api.options.timeout>0){task.timeout=setTimeout(onError,api.options.timeout)}if(img.addEventListener){img.addEventListener("load",onLoad,false);img.addEventListener("error",onError,false)}else{if(img.attachEvent){img.attachEvent("onload",onLoad);img.attachEvent("onerror",onError)}}img.setAttribute("src",task.url)}catch(_error){e=_error;if(log!=null){log("send event",e)}sendNextEvent()}if(!(api.options.timeout>0)){return sendNextEvent()}};api.trackEvent=function(name,parameters){var register,task;if(parameters==null){parameters={}}if(!((accountId!=null?accountId.length:void 0)>0)){return}for(k in parameters){v=parameters[k];if(parameters[k]==null){delete parameters[k]}}parameters._a=accountId;parameters._t=millis();parameters._bxv=_bxv;parameters._bxs=_bxs;parameters._ev=name;parameters._src=features.source.name;parameters._scr=""+features.screen.width+"x"+features.screen.height;parameters._frm=""+features.frame.width+"x"+features.frame.height;parameters._ln=features.language;parameters._tx=((function(){var _results;_results=[];for(k in support){v=support[k];if(!v){continue}_results.push(k)}return _results})()).join(",");if((parameters.choiceId==null)&&(parameters.variantId==null)&&(parameters.visitorId==null)){parameters.choiceId=getParam("ba_choice_id",null);parameters.variantId=getParam("ba_variant_id",null);parameters.visitorId=getParam("ba_visitor_id",null)}task={complete:false,success:false,url:buildUri("//boxalino-tracking.ricardo.ch/frontend/analytics/en/track",parameters),callbacks:[]};queue.push(task);if(loadingTask==null){sendNextEvent()}return register=function(callback){if(task.complete){callback(task.success)}else{task.callbacks.push(callback)}return register}};api.trackPageView=function(uri,page,variant,parameters){var _ref4,_ref5;if(page==null){page=null}if(variant==null){variant=null}if(parameters==null){parameters={}}if(uri==null){uri=buildUri((_ref4=features.location)!=null?_ref4.path:void 0,(_ref5=features.location)!=null?_ref5.parameters:void 0)}parameters.id=uri;parameters.q=page;parameters.p=variant;return api.trackEvent("pageView",parameters)};api.trackSearch=function(query,parameters){if(parameters==null){parameters={}}parameters.id=query;return api.trackEvent("search",parameters)};api.trackCategoryView=function(category,parameters){if(parameters==null){parameters={}}parameters.id=category;return api.trackEvent("categoryView",parameters)};api.trackProductView=function(product,parameters){if(parameters==null){parameters={}}parameters.id=product;return api.trackEvent("productView",parameters)};api.trackLogin=function(userId,parameters){if(parameters==null){parameters={}}parameters.id=userId;return api.trackEvent("login",parameters)};api.trackChoiceSelection=function(choice,variant,visitor,scope,parameters){if(scope==null){scope="system_rec"}if(parameters==null){parameters={}}parameters.choiceId=choice;parameters.variantId=variant;parameters.visitorId=visitor;parameters.scope=scope;return api.trackEvent("choiceSelection",parameters)};api.trackChoiceDisplay=function(choice,variant,visitor,scope,parameters){if(scope==null){scope="system_rec"}if(parameters==null){parameters={}}parameters.choiceId=choice;parameters.variantId=variant;parameters.visitorId=visitor;parameters.scope=scope;return api.trackEvent("choiceDisplay",parameters)};api.trackAddToBasket=function(product,quantity,price,currency,parameters){if(parameters==null){parameters={}}parameters.id=product;parameters.q=quantity;parameters.p=price;parameters.c=currency;return api.trackEvent("addToBasket",parameters)};api.trackPurchase=function(total,currency,products,orderId,parameters){var product,_j,_len1;if(orderId==null){orderId=null}if(parameters==null){parameters={}}parameters.t=total;parameters.c=currency;parameters.n=products.length;parameters.orderId=orderId;for(i=_j=0,_len1=products.length;_j<_len1;i=++_j){product=products[i];parameters["id"+i]=product.product;parameters["q"+i]=product.quantity;parameters["p"+i]=product.price}return api.trackEvent("purchase",parameters)};api.trackMouse=function(ev,parameters){if(parameters==null){parameters={}}parameters.sx=ev.screenX;parameters.sy=ev.screenY;parameters.cx=ev.clientX;parameters.cy=ev.clientY;parameters.bt=ev.button;return api.trackEvent("mouse",parameters)};api.trackLink=function(ev,parameters){var target;if(parameters==null){parameters={}}target=ev.target||ev.srcElement;if(target.tagName!=="A"){target=target.parentElement;while(target!==null&&target.tagName!=="A"){target=target.parentElement}}api.trackMouse(ev,parameters)(function(){return window.top.location=target.href});if(ev.preventDefault!=null){ev.preventDefault()}return false};api.trackInnerClick=function(ev,url,parameters){if(url==null){url=null}if(parameters==null){parameters={}}parameters.id=url;parameters.sx=ev.screenX;parameters.sy=ev.screenY;parameters.cx=ev.clientX;parameters.cy=ev.clientY;parameters.bt=ev.button;return api.trackEvent("innerClick",parameters)};api.trackOuterClick=function(ev,url,parameters){if(url==null){url=null}if(parameters==null){parameters={}}parameters.id=url;parameters.sx=ev.screenX;parameters.sy=ev.screenY;parameters.cx=ev.clientX;parameters.cy=ev.clientY;parameters.bt=ev.button;return api.trackEvent("outerClick",parameters)};api.trackForm=function(ev,parameters){var target;if(parameters==null){parameters={}}target=ev.target||ev.srcElement;if(target.bxTracked!=="true"&&(target.submit!=null)){api.trackMouse(ev,parameters)(function(){target.bxTracked="true";return target.submit()});if(ev.preventDefault!=null){ev.preventDefault()}return false}return true};api.trackGoal=function(name,orderId,productId,parameters){if(orderId==null){orderId=null}if(productId==null){productId=null}if(parameters==null){parameters={}}parameters.id=name;parameters.orderId=orderId;parameters.productId=productId;return api.trackEvent("goal",parameters)};if(window._bxq!=null){_ref4=window._bxq;for(_j=0,_len1=_ref4.length;_j<_len1;_j++){item=_ref4[_j];api.push(item)}}return window._bxq=api})()}).call(this);